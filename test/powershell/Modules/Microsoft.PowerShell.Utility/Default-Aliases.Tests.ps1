Describe "Windows aliases do not conflict with Linux commands" -Tags "CI" {
    BeforeAll {
        $removeAliasList = @("ac","compare","cpp","diff","sleep","sort","start","cat","cp","ls","man","mount","mv","ps","rm","rmdir")
        $keepAliasList = @{cd="Set-Location"},@{dir="Get-ChildItem"},@{echo="Write-output"},@{fc="format-custom"},@{kill="stop-process"},@{clear="clear-host"}
    }

    foreach ($alias in $removeAliasList) {
        It "Should not have certain aliases on Linux" -Skip:$IsWindows {
            Test-Path Alias:$alias | Should Be $false
        }
    }

    foreach ($alias in $keepAliasList) {
        It "Should have aliases that are Bash built-ins on Linux" {
            (Get-Alias $alias.Keys).Definition | Should Be $alias.Values
        }
    }

    It "Should have more as a function" {
        Test-Path Function:more | Should Be $true
    }
}


Describe "Verify approved aliases list" -Tags "CI" {
    BeforeAll {
        if ( !$isCoreCLR ) {
            # Windows FullCLR approved aliases
            $aliaslist = @(
                            "% -> ForEach-Object",
                            "? -> Where-Object",
                            "ac -> Add-Content",
                            "asnp -> Add-PSSnapin",
                            "cat -> Get-Content",
                            "cd -> Set-Location",
                            "CFS -> ConvertFrom-String",
                            "chdir -> Set-Location",
                            "clc -> Clear-Content",
                            "clear -> Clear-Host",
                            "clhy -> Clear-History",
                            "cli -> Clear-Item",
                            "clp -> Clear-ItemProperty",
                            "cls -> Clear-Host",
                            "clv -> Clear-Variable",
                            "cnsn -> Connect-PSSession",
                            "compare -> Compare-Object",
                            "copy -> Copy-Item",
                            "cp -> Copy-Item",
                            "cpi -> Copy-Item",
                            "cpp -> Copy-ItemProperty",
                            "curl -> Invoke-WebRequest",
                            "cvpa -> Convert-Path",
                            "dbp -> Disable-PSBreakpoint",
                            "del -> Remove-Item",
                            "diff -> Compare-Object",
                            "dir -> Get-ChildItem",
                            "dnsn -> Disconnect-PSSession",
                            "ebp -> Enable-PSBreakpoint",
                            "echo -> Write-Output",
                            "epal -> Export-Alias",
                            "epcsv -> Export-Csv",
                            "epsn -> Export-PSSession",
                            "erase -> Remove-Item",
                            "etsn -> Enter-PSSession",
                            "exsn -> Exit-PSSession",
                            "fc -> Format-Custom",
                            "fhx -> Format-Hex",
                            "fl -> Format-List",
                            "foreach -> ForEach-Object",
                            "ft -> Format-Table",
                            "fw -> Format-Wide",
                            "gal -> Get-Alias",
                            "gbp -> Get-PSBreakpoint",
                            "gc -> Get-Content",
                            "gcb -> Get-Clipboard",
                            "gci -> Get-ChildItem",
                            "gcm -> Get-Command",
                            "gcs -> Get-PSCallStack",
                            "gdr -> Get-PSDrive",
                            "ghy -> Get-History",
                            "gi -> Get-Item",
                            "gjb -> Get-Job",
                            "gl -> Get-Location",
                            "gm -> Get-Member",
                            "gmo -> Get-Module",
                            "gp -> Get-ItemProperty",
                            "gps -> Get-Process",
                            "gpv -> Get-ItemPropertyValue",
                            "group -> Group-Object",
                            "gsn -> Get-PSSession",
                            "gsnp -> Get-PSSnapin",
                            "gsv -> Get-Service",
                            "gu -> Get-Unique",
                            "gv -> Get-Variable",
                            "gwmi -> Get-WmiObject",
                            "h -> Get-History",
                            "history -> Get-History",
                            "icm -> Invoke-Command",
                            "iex -> Invoke-Expression",
                            "ihy -> Invoke-History",
                            "ii -> Invoke-Item",
                            "ipal -> Import-Alias",
                            "ipcsv -> Import-Csv",
                            "ipmo -> Import-Module",
                            "ipsn -> Import-PSSession",
                            "irm -> Invoke-RestMethod",
                            "ise -> powershell_ise.exe",
                            "iwmi -> Invoke-WmiMethod",
                            "iwr -> Invoke-WebRequest",
                            "kill -> Stop-Process",
                            "lp -> Out-Printer",
                            "ls -> Get-ChildItem",
                            "man -> help",
                            "md -> mkdir",
                            "measure -> Measure-Object",
                            "mi -> Move-Item",
                            "mount -> New-PSDrive",
                            "move -> Move-Item",
                            "mp -> Move-ItemProperty",
                            "mv -> Move-Item",
                            "nal -> New-Alias",
                            "ndr -> New-PSDrive",
                            "ni -> New-Item",
                            "nmo -> New-Module",
                            "npssc -> New-PSSessionConfigurationFile",
                            "nsn -> New-PSSession",
                            "nv -> New-Variable",
                            "nwsn -> New-PSWorkflowSession",
                            "ogv -> Out-GridView",
                            "oh -> Out-Host",
                            "popd -> Pop-Location",
                            "ps -> Get-Process",
                            "pushd -> Push-Location",
                            "pwd -> Get-Location",
                            "r -> Invoke-History",
                            "rbp -> Remove-PSBreakpoint",
                            "rcjb -> Receive-Job",
                            "rcsn -> Receive-PSSession",
                            "rd -> Remove-Item",
                            "rdr -> Remove-PSDrive",
                            "ren -> Rename-Item",
                            "ri -> Remove-Item",
                            "rjb -> Remove-Job",
                            "rm -> Remove-Item",
                            "rmdir -> Remove-Item",
                            "rmo -> Remove-Module",
                            "rni -> Rename-Item",
                            "rnp -> Rename-ItemProperty",
                            "rp -> Remove-ItemProperty",
                            "rsn -> Remove-PSSession",
                            "rsnp -> Remove-PSSnapin",
                            "rujb -> Resume-Job",
                            "rv -> Remove-Variable",
                            "rvpa -> Resolve-Path",
                            "rwmi -> Remove-WmiObject",
                            "sajb -> Start-Job",
                            "sal -> Set-Alias",
                            "saps -> Start-Process",
                            "sasv -> Start-Service",
                            "sbp -> Set-PSBreakpoint",
                            "sc -> Set-Content",
                            "scb -> Set-Clipboard",
                            "select -> Select-Object",
                            "set -> Set-Variable",
                            "shcm -> Show-Command",
                            "si -> Set-Item",
                            "sl -> Set-Location",
                            "sleep -> Start-Sleep",
                            "sls -> Select-String",
                            "sort -> Sort-Object",
                            "sp -> Set-ItemProperty",
                            "spjb -> Stop-Job",
                            "spps -> Stop-Process",
                            "spsv -> Stop-Service",
                            "start -> Start-Process",
                            "sujb -> Suspend-Job",
                            "sv -> Set-Variable",
                            "swmi -> Set-WmiInstance",
                            "tee -> Tee-Object",
                            "trcm -> Trace-Command",
                            "type -> Get-Content",
                            "wget -> Invoke-WebRequest",
                            "where -> Where-Object",
                            "wjb -> Wait-Job",
                            "write -> Write-Output"
                        )
        } else { 
                If ($IsWindows) {
                    # PowerShell Core approved aliases on Windows
                    $aliaslist = @(
                                    "% -> ForEach-Object",
                                    "? -> Where-Object",
                                    "ac -> Add-Content",
                                    "cat -> Get-Content",
                                    "cd -> Set-Location",
                                    "chdir -> Set-Location",
                                    "clc -> Clear-Content",
                                    "clear -> Clear-Host",
                                    "clhy -> Clear-History",
                                    "cli -> Clear-Item",
                                    "clp -> Clear-ItemProperty",
                                    "cls -> Clear-Host",
                                    "clv -> Clear-Variable",
                                    "cnsn -> Connect-PSSession",
                                    "compare -> Compare-Object",
                                    "copy -> Copy-Item",
                                    "cp -> Copy-Item",
                                    "cpi -> Copy-Item",
                                    "cpp -> Copy-ItemProperty",
                                    "cvpa -> Convert-Path",
                                    "dbp -> Disable-PSBreakpoint",
                                    "del -> Remove-Item",
                                    "diff -> Compare-Object",
                                    "dir -> Get-ChildItem",
                                    "dnsn -> Disconnect-PSSession",
                                    "ebp -> Enable-PSBreakpoint",
                                    "echo -> Write-Output",
                                    "epal -> Export-Alias",
                                    "epcsv -> Export-Csv",
                                    "erase -> Remove-Item",
                                    "etsn -> Enter-PSSession",
                                    "exsn -> Exit-PSSession",
                                    "fc -> Format-Custom",
                                    "fhx -> Format-Hex",
                                    "fl -> Format-List",
                                    "foreach -> ForEach-Object",
                                    "ft -> Format-Table",
                                    "fw -> Format-Wide",
                                    "gal -> Get-Alias",
                                    "gbp -> Get-PSBreakpoint",
                                    "gc -> Get-Content",
                                    "gci -> Get-ChildItem",
                                    "gcm -> Get-Command",
                                    "gcs -> Get-PSCallStack",
                                    "gdr -> Get-PSDrive",
                                    "ghy -> Get-History",
                                    "gi -> Get-Item",
                                    "gin -> Get-ComputerInfo",
                                    "gjb -> Get-Job",
                                    "gl -> Get-Location",
                                    "gm -> Get-Member",
                                    "gmo -> Get-Module",
                                    "gp -> Get-ItemProperty",
                                    "gps -> Get-Process",
                                    "gpv -> Get-ItemPropertyValue",
                                    "group -> Group-Object",
                                    "gsn -> Get-PSSession",
                                    "gsv -> Get-Service",
                                    "gtz -> Get-TimeZone",
                                    "gu -> Get-Unique",
                                    "gv -> Get-Variable",
                                    "h -> Get-History",
                                    "history -> Get-History",
                                    "icm -> Invoke-Command",
                                    "iex -> Invoke-Expression",
                                    "ihy -> Invoke-History",
                                    "ii -> Invoke-Item",
                                    "ipal -> Import-Alias",
                                    "ipcsv -> Import-Csv",
                                    "ipmo -> Import-Module",
                                    "irm -> Invoke-RestMethod",
                                    "iwr -> Invoke-WebRequest",
                                    "kill -> Stop-Process",
                                    "ls -> Get-ChildItem",
                                    "man -> help",
                                    "md -> mkdir",
                                    "measure -> Measure-Object",
                                    "mi -> Move-Item",
                                    "mount -> New-PSDrive",
                                    "move -> Move-Item",
                                    "mp -> Move-ItemProperty",
                                    "mv -> Move-Item",
                                    "nal -> New-Alias",
                                    "ndr -> New-PSDrive",
                                    "ni -> New-Item",
                                    "nmo -> New-Module",
                                    "nsn -> New-PSSession",
                                    "nv -> New-Variable",
                                    "oh -> Out-Host",
                                    "popd -> Pop-Location",
                                    "ps -> Get-Process",
                                    "pushd -> Push-Location",
                                    "pwd -> Get-Location",
                                    "r -> Invoke-History",
                                    "rbp -> Remove-PSBreakpoint",
                                    "rcjb -> Receive-Job",
                                    "rcsn -> Receive-PSSession",
                                    "rd -> Remove-Item",
                                    "rdr -> Remove-PSDrive",
                                    "ren -> Rename-Item",
                                    "ri -> Remove-Item",
                                    "rjb -> Remove-Job",
                                    "rm -> Remove-Item",
                                    "rmdir -> Remove-Item",
                                    "rmo -> Remove-Module",
                                    "rni -> Rename-Item",
                                    "rnp -> Rename-ItemProperty",
                                    "rp -> Remove-ItemProperty",
                                    "rsn -> Remove-PSSession",
                                    "rv -> Remove-Variable",
                                    "rvpa -> Resolve-Path",
                                    "sajb -> Start-Job",
                                    "sal -> Set-Alias",
                                    "saps -> Start-Process",
                                    "sasv -> Start-Service",
                                    "sbp -> Set-PSBreakpoint",
                                    "sc -> Set-Content",
                                    "select -> Select-Object",
                                    "set -> Set-Variable",
                                    "si -> Set-Item",
                                    "sl -> Set-Location",
                                    "sleep -> Start-Sleep",
                                    "sls -> Select-String",
                                    "sort -> Sort-Object",
                                    "sp -> Set-ItemProperty",
                                    "spjb -> Stop-Job",
                                    "spps -> Stop-Process",
                                    "spsv -> Stop-Service",
                                    "start -> Start-Process",
                                    "stz -> Set-TimeZone",
                                    "sv -> Set-Variable",
                                    "tee -> Tee-Object",
                                    "type -> Get-Content",
                                    "where -> Where-Object",
                                    "wjb -> Wait-Job",
                                    "write -> Write-Output"
                                )
                } else {
                    # PowerShell Core approved aliases on Unix
                    $aliaslist = @(
                                    "% -> ForEach-Object",
                                    "? -> Where-Object",
                                    "cd -> Set-Location",
                                    "chdir -> Set-Location",
                                    "clc -> Clear-Content",
                                    "clear -> Clear-Host",
                                    "clhy -> Clear-History",
                                    "cli -> Clear-Item",
                                    "clp -> Clear-ItemProperty",
                                    "cls -> Clear-Host",
                                    "clv -> Clear-Variable",
                                    "cnsn -> Connect-PSSession",
                                    "copy -> Copy-Item",
                                    "cpi -> Copy-Item",
                                    "cvpa -> Convert-Path",
                                    "dbp -> Disable-PSBreakpoint",
                                    "del -> Remove-Item",
                                    "dir -> Get-ChildItem",
                                    "dnsn -> Disconnect-PSSession",
                                    "ebp -> Enable-PSBreakpoint",
                                    "echo -> Write-Output",
                                    "epal -> Export-Alias",
                                    "epcsv -> Export-Csv",
                                    "erase -> Remove-Item",
                                    "etsn -> Enter-PSSession",
                                    "exsn -> Exit-PSSession",
                                    "fc -> Format-Custom",
                                    "fhx -> Format-Hex",
                                    "fl -> Format-List",
                                    "foreach -> ForEach-Object",
                                    "ft -> Format-Table",
                                    "fw -> Format-Wide",
                                    "gal -> Get-Alias",
                                    "gbp -> Get-PSBreakpoint",
                                    "gc -> Get-Content",
                                    "gci -> Get-ChildItem",
                                    "gcm -> Get-Command",
                                    "gcs -> Get-PSCallStack",
                                    "gdr -> Get-PSDrive",
                                    "ghy -> Get-History",
                                    "gi -> Get-Item",
                                    "gin -> Get-ComputerInfo",
                                    "gjb -> Get-Job",
                                    "gl -> Get-Location",
                                    "gm -> Get-Member",
                                    "gmo -> Get-Module",
                                    "gp -> Get-ItemProperty",
                                    "gps -> Get-Process",
                                    "gpv -> Get-ItemPropertyValue",
                                    "group -> Group-Object",
                                    "gsn -> Get-PSSession",
                                    "gsv -> Get-Service",
                                    "gu -> Get-Unique",
                                    "gv -> Get-Variable",
                                    "h -> Get-History",
                                    "history -> Get-History",
                                    "icm -> Invoke-Command",
                                    "iex -> Invoke-Expression",
                                    "ihy -> Invoke-History",
                                    "ii -> Invoke-Item",
                                    "ipal -> Import-Alias",
                                    "ipcsv -> Import-Csv",
                                    "ipmo -> Import-Module",
                                    "irm -> Invoke-RestMethod",
                                    "iwr -> Invoke-WebRequest",
                                    "kill -> Stop-Process",
                                    "md -> mkdir",
                                    "measure -> Measure-Object",
                                    "mi -> Move-Item",
                                    "move -> Move-Item",
                                    "mp -> Move-ItemProperty",
                                    "nal -> New-Alias",
                                    "ndr -> New-PSDrive",
                                    "ni -> New-Item",
                                    "nmo -> New-Module",
                                    "nsn -> New-PSSession",
                                    "nv -> New-Variable",
                                    "oh -> Out-Host",
                                    "popd -> Pop-Location",
                                    "pushd -> Push-Location",
                                    "pwd -> Get-Location",
                                    "r -> Invoke-History",
                                    "rbp -> Remove-PSBreakpoint",
                                    "rcjb -> Receive-Job",
                                    "rcsn -> Receive-PSSession",
                                    "rd -> Remove-Item",
                                    "rdr -> Remove-PSDrive",
                                    "ren -> Rename-Item",
                                    "ri -> Remove-Item",
                                    "rjb -> Remove-Job",
                                    "rmo -> Remove-Module",
                                    "rni -> Rename-Item",
                                    "rnp -> Rename-ItemProperty",
                                    "rp -> Remove-ItemProperty",
                                    "rsn -> Remove-PSSession",
                                    "rv -> Remove-Variable",
                                    "rvpa -> Resolve-Path",
                                    "sajb -> Start-Job",
                                    "sal -> Set-Alias",
                                    "saps -> Start-Process",
                                    "sasv -> Start-Service",
                                    "sbp -> Set-PSBreakpoint",
                                    "sc -> Set-Content",
                                    "select -> Select-Object",
                                    "set -> Set-Variable",
                                    "si -> Set-Item",
                                    "sl -> Set-Location",
                                    "sls -> Select-String",
                                    "sp -> Set-ItemProperty",
                                    "spjb -> Stop-Job",
                                    "spps -> Stop-Process",
                                    "spsv -> Stop-Service",
                                    "sv -> Set-Variable",
                                    "type -> Get-Content",
                                    "where -> Where-Object",
                                    "wjb -> Wait-Job"
                                )
                }
        }
    }

    It "All approved aliases present (no aliases removed, no new aliases added)" {
        # We control only default engine aliases (Source -eq "") and aliases from following default loaded modules
        $moduleList = @("Microsoft.PowerShell.Utility", "Microsoft.PowerShell.Management")
        $currentAliasList = Get-Alias | Where-Object { $_.Source -eq "" -or $moduleList -contains $_.Source } | Select-Object -ExpandProperty DisplayName

        Compare-Object -ReferenceObject $currentAliasList -DifferenceObject $aliaslist | Should Be $null
    }
}
